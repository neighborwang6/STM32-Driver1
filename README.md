# STM32-Driver1
基于STM32的标准库所写的一些驱动程序，例如输入脉宽采集、PWM等。
在bsp_InputCapture.c文件中实现对基本外设的初始化，在bsp_InputCapture.h文件中完成接口设计，以及相关的宏定义。
  1、基本设置：时钟开启，GPIO配置。
  2、TIM的TimeBase的设置，包括周期（设置周期就一定要设置自动重装）、分频并使能计数器。
  3、CHx的设置：配置成输入捕获模式、设置输入滤波器、初始触发的极性（上升沿）。
  4、中断的配置：初始是上升沿触发中断，定时器溢出重装计数器（计数超过周期，并且在上升沿已经发生，下降沿还没有来）后update事件引发中断
  5、中断的配置（NVIC）。


#最重要的是中断服务函数。
@在测量脉宽时候，有几种情况需要考虑：
   1、因为输入的脉宽不固定，所以定时器的周期没有办法确定。所选的就是定时器计数周期比最长的脉宽大一点点。
   2、两次事件发生时候，两次捕捉的定时器的值的大小关系无法确定，所以需要判断。
   3、上升沿已经发生，下降沿还没有来。计数器计数超过一个以及以上的计数器周期。需要对重装次数进行记录。
   
   __IO uint32_t Update_Flag_Counter = 0;               //溢出次数的检测
  __IO uint16_t IC3ReadValue1 = 0, IC3ReadValue2 = 0;   //上升沿事件发生时记录的数据，下降沿事件发生时记录的数据
  __IO uint16_t CaptureNumber = 0;                      //事件种类的标记。（上升/下降沿事件）
  __IO uint32_t Pulse_Width_Counter = 0;                //两次事件捕捉之间计数器走过的数量。
  __IO uint32_t Distance_Counter = 0;                   //数组的下标变量，作为数组遍历使用
  
  #具体流程：当程序发生中断时：
    1、首先判断是不是因为溢出update事件引发的中断，如果是，就不执行接下来的边沿判断。Update_Flag_Counter += 1。
    2、如果不是，则进行边沿判断通过CaptureNumber的值进行判断。
    
